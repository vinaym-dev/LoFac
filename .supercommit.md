# Super Commit - Message Format (Spec)

**Goal:** A single commit message should contain all the automation hints needed to:
- update Jira issue status,
- log work in Tempo,
- optionally add a Jira issue comment.

---

## Format (single line)

```
<ISSUE-KEY> [STATUS:<new-status>] [LOG:<hours>@<yyyy-mm-dd>] [COMMENT:<free text>]
```

- `<ISSUE-KEY>` — **required**, looks like `ABC-123` (2–10 uppercase letters, hyphen, number).
- `STATUS:` — optional. Any Jira status name (spaces allowed). We will match by name case-insensitively.
- `LOG:` — optional. Hours like `1h`, `2.5h`, followed by `@` and ISO date `YYYY-MM-DD`.
- `COMMENT:` — optional free text (spaces and punctuation allowed).

Tokens can appear **in any order** and are **space-separated**. Empty values are not allowed.

Note: If you write a multi-line commit, only the first line must follow this spec; later lines are ignored by automation.

---

## Examples — Valid

```
PAY-101 STATUS:In Progress LOG:2h@2025-10-01 COMMENT:Started building payment flow
ABC-7 LOG:1.5h@2025-10-02
OPS-55 STATUS:Ready for Testing COMMENT:Handed off to QA
```

---

## Examples — Invalid (and why)

```
PAY101 STATUS:In Progress    (missing hyphen in issue key)
PAY-101 LOG:2@2025-10-01    (hours must include "h", e.g., 2h)
PAY-101 STATUS:             (empty status value)
PAY-101 FOO:bar             (unknown token "FOO:")
```

---

## Validation Regex (full-line)

Use this regex to validate the first line of the commit message. It supports tokens in any order and captures the last occurrence of each token into named groups.

```
^(?<ISSUE>[A-Z][A-Z0-9]{1,9}-\d+)(?:\s+(?:STATUS:(?<STATUS>.+?)(?=\s+(?:STATUS|LOG|COMMENT):|$)|LOG:(?<LOG_HOURS>\d+(?:\.\d+)?)@(?<LOG_DATE>\d{4}-\d{2}-\d{2})|COMMENT:(?<COMMENT>.+?)(?=\s+(?:STATUS|LOG|COMMENT):|$)))*$
```

**Named capture groups produced (when present):**
- `ISSUE` — e.g., `PAY-101`
- `STATUS` — e.g., `In Progress`
- `LOG_HOURS` — e.g., `2.5`
- `LOG_DATE` — e.g., `2025-10-01`
- `COMMENT` — e.g., `Refactored data access`

This regex is for validation and primary capture. The CI parser will also do stricter checks (non-empty values, one LOG max, valid date, etc.).

---

## Authoring Tips

- Keep it one line; additional detail can go into the PR description.
- Prefer real Jira status names (e.g., In Progress, Ready for Testing). The automation will look up transitions dynamically.
- If you only want to log time without changing status:

```
PAY-101 LOG:1h@2025-10-03 COMMENT:Investigated bug and added unit tests
```